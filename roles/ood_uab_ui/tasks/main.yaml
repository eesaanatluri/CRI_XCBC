---
- name: Copy the configure file for apps
  template:
    src: "{{ app_name }}/env_local.j2"
    dest: "/var/www/ood/apps/sys/{{ app_name }}/.env.local"
  vars:
    app_name: "{{ item }}"
  with_items:
    - dashboard
    - myjobs
    - shell

- name: Add shared directories into files menu
  template:
    src: dashboard/ood_rb.j2
    dest: /var/www/ood/apps/sys/dashboard/config/initializers/ood.rb

- name: Add cheaha logo image
  copy:
    src: "{{ ood_dashboard_logo_filename }}"
    dest: "/var/www/ood/public"

- name: Rebuild assets for apps and force apps to restart
  shell: |
    scl enable git19 rh-ruby22 nodejs010 -- bin/rake assets:clobber RAILS_ENV=production
    scl enable git19 rh-ruby22 nodejs010 -- bin/rake assets:precompile RAILS_ENV=production
    touch tmp/restart.txt
  args:
    chdir: "/var/www/ood/apps/sys/{{ app_name }}"
  vars:
    app_name: "{{ item }}"
  with_items:
    - dashboard
    - myjobs

- name: Put motd in place
  template:
    src: motd.j2
    dest: /etc/ood/motd
